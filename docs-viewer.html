<!DOCTYPE html>
<html>
<head>
    <title>Wolfpack Architecture Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        h1, h2 { color: #4ec9b0; }
        h3 { color: #dcdcaa; }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        pre {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            color: #ce9178;
        }
        a {
            color: #569cd6;
        }
        .nav {
            position: sticky;
            top: 0;
            background: #1e1e1e;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 2px solid #4ec9b0;
        }
        .nav a {
            margin-right: 20px;
            text-decoration: none;
            font-weight: bold;
        }
        .nav a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="nav">
        <a href="#hierarchy">Class Hierarchy</a>
        <a href="#gamescene">GameScene</a>
        <a href="#statemachine">State Machine</a>
        <a href="#ecosystem">Ecosystem</a>
        <a href="#boids">Boids</a>
        <a href="#spawning">Spawning</a>
    </div>

    <h1>üé£ Wolfpack Fishing Game - Architecture Documentation</h1>
    <p>Interactive visualization of the game's architecture</p>

    <h2 id="hierarchy">1. Entity Class Hierarchy</h2>
    <div class="diagram-container">
        <div class="mermaid">
classDiagram
    class AquaticOrganism {
        +scene
        +id
        +worldX
        +x (screen)
        +y
        +depth
        +size
        +length
        +age
        +speed
        +visible
        +updateScreenPosition()
        +getBottomDepthAtPosition()
        +isTooFarFromPlayer()
    }

    class FishSprite {
        +species
        +speciesData
        +sizeCategory
        +weight
        +hunger
        +health
        +ai: FishAI
        +caught
        +inFrenzy
        +stomachContents[]
        +feedOnBaitfish()
        +updateFish()
        +triggerInterestFlash()
    }

    class BaitfishSprite {
        +species
        +speciesData
        +schoolId
        +velocity
        +consumed
        +schooling (boids forces)
        +applyBoidsMovement()
        +flee()
        +updateBaitfish()
    }

    class Zooplankton {
        +consumed
        +driftDirection
        +driftSpeed
        +maxAge
        +consume()
        +update()
        +render()
    }

    class Crayfish {
        +species
        +burrowX
        +burrowY
        +isInBurrow
        +scaredUntil
        +update()
        +flee()
    }

    AquaticOrganism <|-- FishSprite
    AquaticOrganism <|-- BaitfishSprite
    AquaticOrganism <|-- Zooplankton
    AquaticOrganism <|-- Crayfish

    Phaser_Sprite <|-- FishSprite
    Phaser_Sprite <|-- BaitfishSprite

    FishSprite *-- FishAI : contains

    class FishAI {
        +fish: FishSprite
        +state
        +targetBaitfishCloud
        +targetBaitfish
        +leavingArea
        +lastBaitfishSightingTime
        +update()
        +getMovementVector()
        +detectFrenzy()
        +evaluateLure()
    }
        </div>
    </div>

    <h2 id="statemachine">2. FishAI State Machine</h2>
    <div class="diagram-container">
        <div class="mermaid">
stateDiagram-v2
    [*] --> IDLE

    IDLE --> INVESTIGATING : Lure detected
    IDLE --> HUNTING_BAITFISH : Baitfish detected
    IDLE --> MIGRATING : No food for 10s

    INVESTIGATING --> CHASING : Interest builds
    INVESTIGATING --> IDLE : Lost interest

    CHASING --> STRIKING : Within strike range
    CHASING --> IDLE : Lost lure

    STRIKING --> HOOKED : Player hookset
    STRIKING --> IDLE : Missed hookset

    HOOKED --> FIGHTING : Fish fight begins
    FIGHTING --> CAUGHT : Stamina depleted
    FIGHTING --> ESCAPED : Line breaks

    HUNTING_BAITFISH --> FEEDING : Catches baitfish
    HUNTING_BAITFISH --> IDLE : Lost prey

    FEEDING --> IDLE : Prey consumed
    FEEDING --> HUNTING_BAITFISH : Still hungry

    MIGRATING --> [*] : Swims off-screen

    note right of INVESTIGATING
        Bass: Circles lure
        Pike: Ambush position
        Trout: Direct approach
    end note
        </div>
    </div>

    <h2 id="ecosystem">3. Ecosystem Flow</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph LR
    subgraph Bottom["Lake Bottom"]
        Zoop[Zooplankton<br/>Drift slowly<br/>50-100s lifespan]
    end

    subgraph MidWater["Mid-Water"]
        Schools[Baitfish Schools<br/>Rainbow Smelt<br/>Alewife<br/>8-25 per school]
    end

    subgraph Predators["Predators"]
        LakeTrout[Lake Trout<br/>Hunt baitfish<br/>Hunt lure]
        Pike[Northern Pike<br/>Ambush predator]
        Bass[Smallmouth Bass<br/>Circles before strike]
    end

    subgraph Player["Player"]
        Lure[Lure<br/>Controlled by player]
    end

    Zoop -->|consumed by| Schools
    Schools -->|hunted by| Predators
    Schools -->|flee from| Predators
    Lure -->|attracts| Predators
    Predators -->|strike| Lure

    Schools -.->|no food| Migration1[Swim to surface & despawn]
    Predators -.->|no food 10s| Migration2[Swim off-screen & despawn]
        </div>
    </div>

    <h2 id="boids">4. Boids Algorithm</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TB
    subgraph School["School Behavior"]
        Center[School Center<br/>centerWorldX, centerY]
    end

    subgraph BaitfishBehavior["Individual Baitfish Forces"]
        Separation[Separation<br/>Avoid crowding<br/>8-25px radius]
        Cohesion[Cohesion<br/>Move toward center]
        Alignment[Alignment<br/>Match neighbor velocity]
        FoodAttraction[Food Attraction<br/>Seek zooplankton<br/>0.5 strength]
        Panic[Panic Response<br/>Flee predators]
    end

    Center -->|pulls toward| Cohesion
    Separation -->|combines| FinalVelocity[Final Velocity]
    Cohesion -->|combines| FinalVelocity
    Alignment -->|combines| FinalVelocity
    FoodAttraction -->|combines| FinalVelocity
    Panic -->|overrides| FinalVelocity

    FinalVelocity -->|clamped| Boundaries[Water Boundaries<br/>Surface: 0<br/>Floor: 554]
        </div>
    </div>

    <h2 id="spawning">5. Spawning System</h2>
    <div class="diagram-container">
        <div class="mermaid">
flowchart TD
    Start[GameScene Update]
    Start --> Spawn[SpawningSystem.update]

    Spawn --> CheckFish{Fish count < 5?}
    CheckFish -->|Yes| SpawnFish[trySpawnFish<br/>Random species<br/>Random size<br/>Off-screen spawn]
    CheckFish -->|No| CheckSchools

    SpawnFish --> FishGroup[Add to fishGroup]

    CheckSchools{School count < 3?}
    CheckSchools -->|Yes| SpawnSchool[trySpawnSchool<br/>8-25 fish<br/>Far off-screen]
    CheckSchools -->|No| CheckZoop

    SpawnSchool --> SchoolArray[Add to schools array]

    CheckZoop{Zooplankton < 200?}
    CheckZoop -->|Yes| SpawnZoop[spawnZooplankton<br/>3-6 at a time<br/>Bottom depth]
    CheckZoop -->|No| CheckCray

    SpawnZoop --> ZoopArray[Add to zooplankton array]

    CheckCray{Crayfish < 15?}
    CheckCray -->|Yes| SpawnCray[spawnCrayfish<br/>Bottom only]
    CheckCray -->|No| End

    SpawnCray --> CrayArray[Add to crayfish array]

    FishGroup --> End[Continue Update]
    SchoolArray --> End
    ZoopArray --> End
    CrayArray --> End
        </div>
    </div>

    <h2>üìÅ File Reference</h2>
    <pre><code>src/scenes/GameScene.js           - Main orchestrator
src/entities/FishAI.js            - Predator AI
src/models/AquaticOrganism.js     - Base class
src/models/FishSprite.js          - Predator fish
src/models/BaitfishSprite.js      - Schooling prey
src/models/Zooplankton.js         - Bottom food source
src/scenes/systems/SpawningSystem.js  - Entity spawning
src/scenes/systems/CollisionSystem.js - Interactions
src/utils/SonarDisplay.js         - Background rendering</code></pre>

    <h2>üé® Rendering Layers (Z-Index)</h2>
    <pre><code>0   - SonarDisplay (background, lake floor, grid)
10  - Zooplankton graphics
3   - School effects graphics
50  - Fish sprites (FishSprite, BaitfishSprite)
60  - Fishing line
100 - Depth markers, UI text
2000+ - Tackle box, menus, overlays</code></pre>

    <p style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #4ec9b0;">
        <strong>Full Documentation:</strong><br>
        ‚Ä¢ <code>ARCHITECTURE.md</code> - Complete system overview<br>
        ‚Ä¢ <code>FISHAI_GUIDE.md</code> - Deep dive into fish behavior
    </p>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#4ec9b0',
                primaryTextColor: '#000',
                primaryBorderColor: '#569cd6',
                lineColor: '#dcdcaa',
                secondaryColor: '#ce9178',
                tertiaryColor: '#d4d4d4'
            }
        });
    </script>
</body>
</html>
